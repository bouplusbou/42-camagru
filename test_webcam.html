<style>
.video-wrap {
	position: relative;
}
video {
	width: 800px;
}
#sticker_container {
	border: solid 1px lightgray;
	border-radius: 15px;
	padding: 20px;
	width: 760px;
	height: 100px;
	display: flex;
	justify-content: space-between;
	align-items: center;
}
#sticker_container > div {
	margin: 0 10px;
}
#sticker_container > div > img {
	height: 80px;
}
#overlay {
	position: absolute;
	top: 50;
	left: 50;
}

</style>

<!-- Stream video via webcam -->
<div class="video-wrap">
    <video id="video" playsinline autoplay></video>
</div>

<div id="overlay">
	<img src="succes.png" alt="">
</div>

<!-- Trigger canvas web API -->
<div class="controller">
    <button id="snap">Capture</button>
</div>

<div id="sticker_container">
	<div class="sticker">
		<img src="logo_artsy_blue.png" alt="">
	</div>
	<div class="sticker">
		<img src="succes.png" alt="">
	</div>
	<div class="sticker">
		<img src="favicon.png" alt="">
	</div>
	<div class="sticker">
		<img src="troll.png" alt="">
	</div>
</div>

<!-- Webcam video snapshot -->
<canvas id="canvas" width="1280" height="720"></canvas>

<div id="show64">

</div>


<div id="message" style="color:red;"></div>

<script>
'use strict';

const video = document.getElementById('video');
const canvas = document.getElementById('canvas');
const snap = document.getElementById("snap");
const errorMsgElement = document.querySelector('span#errorMsg');

const constraints = {
  audio: false,
  video: {
    width: 1280, height: 720
  }
};

// Access webcam
async function init() {
  try {
    const stream = await navigator.mediaDevices.getUserMedia(constraints);
    handleSuccess(stream);
  } catch (e) {
    errorMsgElement.innerHTML = `navigator.getUserMedia error:${e.toString()}`;
  }
}

// Success
function handleSuccess(stream) {
  window.stream = stream;
  video.srcObject = stream;
}


// Load init
init();

const show = document.getElementById("show64");

// Draw image
var context = canvas.getContext('2d');
snap.addEventListener("click", function() {
	context.drawImage(video, 0, 0, 1280, 720);
	
	// Save and send to the server
	var dataURL = canvas.toDataURL();
	let newImg = document.createElement("img");
	newImg.setAttribute('src', dataURL);;
	show.prepend(newImg);

	// send to the server using AJAX
	var src_img = "src_img="+dataURL;
	var ajx = new XMLHttpRequest();
    ajx.onreadystatechange = function () {
        if (ajx.readyState == 4 && ajx.status == 200) {
            document.getElementById("message").innerHTML = ajx.responseText;
        }
    };
    ajx.open("POST", "webcam.php", true);
    ajx.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    ajx.send(src_img);
});



</script>

