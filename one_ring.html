<style>
		body {
			height: 100%;
			margin: 0;
			padding: 0;
		}
		.video-wrap {
			position: relative;
		}
		video {
			width: 1280px;
		}
		#sticker_container {
			border: solid 1px lightgray;
			border-radius: 15px;
			padding: 20px;
			width: 760px;
			height: 100px;
			display: flex;
			justify-content: space-between;
			align-items: center;
		}
		#sticker_container > div {
			margin: 0 10px;
		}
		#sticker_container > div > img {
			height: 80px;
		}
		#overlay {
			position: absolute;
			top: 0;
			left: 0;
		}
		.dragme {
			position:relative;
			width: 300px;
			height: 300px;
			cursor: move;
		}
		
		</style>
		
		<!-- Stream video via webcam -->
		<div class="video-wrap">
			<video id="video" playsinline autoplay></video>
		</div>
		
		<div id="overlay">
		</div>
		
		<!-- Trigger canvas web API -->
		<div class="controller">
			<button id="snap">Capture</button>
		</div>
		
		<div id="sticker_container">
			<div class="sticker">
				<img src="src_images/grumpy.png" alt="">
			</div>
			<div class="sticker">
				<img src="src_images/fries.png" alt="">
			</div>
			<div class="sticker">
				<img src="src_images/hands.png" alt="">
			</div>
			<div class="sticker">
				<img src="src_images/thug.png" alt="">
			</div>
			<div class="sticker">
				<img src="src_images/pate.png" alt="">
			</div>
			<div class="sticker">
				<img src="src_images/beard.png" alt="">
			</div>
		</div>
		
		<!-- Webcam video snapshot -->
		<canvas id="canvas" width="1280" height="720"></canvas>
		
		<!-- <div id="show64">
		
		</div> -->
		
		
		<div id="message" style="color:red;"></div>
		
		<script>

			let selected_sticker_src;

	////////////////////////////////////////////////////////////////////////////////////////////////////////////// apply the right sticker
			const stickers = document.getElementById('sticker_container');
			const overlay = document.getElementById('overlay');
			stickers.addEventListener("click", function() {
				if (event.target.tagName == 'IMG') {
					if (overlay.firstChild) {
					    overlay.removeChild(overlay.firstChild);
					}
					let selected_sticker = document.createElement('img');
					selected_sticker.setAttribute('src', event.target.src);
					selected_sticker_src = event.target.src;
					selected_sticker.setAttribute('id', 'selected_sticker');
					selected_sticker.setAttribute('class', 'dragme');
					overlay.append(selected_sticker);
				}
			});


	//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// drag the sticker
			function startDrag(e) {

				// determine event object
				if (!e) {
					var e = window.event;
				}
			
				// IE uses srcElement, others use target
				var targ = e.target ? e.target : e.srcElement;
			
				if (targ.className != 'dragme') {return};
				// calculate event X, Y coordinates
					offsetX = e.clientX;
					offsetY = e.clientY;
			
				// assign default values for top and left properties
				if(!targ.style.left) { targ.style.left='0px'};
				if (!targ.style.top) { targ.style.top='0px'};
			
				// calculate integer values for top and left 
				// properties
				coordX = parseInt(targ.style.left);
				coordY = parseInt(targ.style.top);
				drag = true;
			
				// move div element
					document.onmousemove=dragDiv;
			
			}
			function dragDiv(e) {
				//check if concern img only
				if (event.target.tagName != 'IMG')
					return;
				
				
				if (!drag) {return};
				if (!e) { var e= window.event};
				var targ=e.target?e.target:e.srcElement;

				//add condition to block the move
				if (e.clientX > 1280)
					targ.style.left='980px';
				else
					targ.style.left=coordX+e.clientX-offsetX+'px';
				if (e.clientY > 720)
					targ.style.top='420px';
				else
					targ.style.top=coordY+e.clientY-offsetY+'px';
			
			
				// move div element
				// targ.style.left=coordX+e.clientX-offsetX+'px';
				// targ.style.top=coordY+e.clientY-offsetY+'px';
				return false;
			}
			function stopDrag() {
				drag=false;
			}
			window.onload = function() {
				document.onmousedown = startDrag;
				document.onmouseup = stopDrag;
			}





	/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// send to server
		'use strict';
		
		const video = document.getElementById('video');
		const canvas = document.getElementById('canvas');
		const snap = document.getElementById("snap");
		const errorMsgElement = document.querySelector('span#errorMsg');
		
		const constraints = {
		  audio: false,
		  video: {
			width: 1280, height: 720
		  }
		};
		
		// Access webcam
		async function init() {
		  try {
			const stream = await navigator.mediaDevices.getUserMedia(constraints);
			handleSuccess(stream);
		  } catch (e) {
			errorMsgElement.innerHTML = `navigator.getUserMedia error:${e.toString()}`;
		  }
		}
		
		// Success
		function handleSuccess(stream) {
		  window.stream = stream;
		  video.srcObject = stream;
		}
		
		
		// Load init
		init();
		
		const show = document.getElementById("show64");
		
		// Draw image
		var context = canvas.getContext('2d');
		snap.addEventListener("click", function() {
			context.drawImage(video, 0, 0, 1280, 720);
			
			// Save and send to the server
			var dst_img = canvas.toDataURL();
			let newImg = document.createElement("img");



			// show the screenshot
			// newImg.setAttribute('src', dst_img);;
			// show.prepend(newImg);
		


			// get the coord to position the src + the path
			var placement_x = parseInt(selected_sticker.style.left, 10);
			var placement_y = parseInt(selected_sticker.style.top, 10);
			var src_img = selected_sticker_src;

			// send to the server using AJAX
			var img_details = "placement_x="+placement_x+"&placement_y="+placement_y+"&dst_img="+dst_img+"&src_img="+src_img;
			var ajx = new XMLHttpRequest();
			ajx.onreadystatechange = function () {
				if (ajx.readyState == 4 && ajx.status == 200) {
					document.getElementById("message").innerHTML = ajx.responseText;
				}
			};
			ajx.open("POST", "webcam.php", true);
			ajx.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
			ajx.send(img_details);
		});
		
		
		
		</script>
		
		